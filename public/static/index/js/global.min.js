window.$ = jQuery;
window.favorite_link_init = function() {
    jQuery(".favorite").click(function() {
        var rateHolder = jQuery(this).children(".love-count"),
            heart = jQuery(this).children(".fa");
        if (jQuery(this).hasClass("done")) {
            rateHolder.html("已经点过赞啦");
            heart.hide().fadeIn(500);
            return false
        } else {
            jQuery(this).addClass("done");
            heart.hide().fadeIn(700);
            rateHolder.hide().fadeIn(300);
            var num = +rateHolder.html();
            rateHolder.html("谢谢喜欢");
            setTimeout(function() {
                rateHolder.html(num + 1)
            }, 2e3);
            var id = jQuery(this).data("id"),
                action = jQuery(this).data("action");
            var ajax_data = {
                action: "mzw_like",
                um_id: id,
                um_action: action
            };
            jQuery.post(window.ajax.ajax_url, ajax_data);
            return false
        }
    })
};
window.favorite_link_init();

//saying
jQuery.fn.typing = function(n) {
    var _this = $(this);
    var rnd_saying = _this.hasClass("saying-title");
    if (!rnd_saying) return;
    var options = {
        speed: 200,
        delSpeed: 100,
        show: 5e3
    };
    $.extend(options, n);
    var index = 1;
    var direction = 1;
    _this.css("border-right", "1px solid #000");
    var text = $(this).text().trim(),
        text2 = text;
    setTimeout(init, options.speed);

    function init() {
        _this.html(text.substr(0, index));
        if (index >= text.length) {
            direction = -1;
            setTimeout(init, options.show)
        } else if (index <= 0) {
            direction = 1;
            setTimeout(init, options.speed);
            if (rnd_saying && text2 !== text) {
                text = text2;
                refresh_saying()
            }
        } else if (direction > 0) setTimeout(init, options.speed);
        else setTimeout(init, options.delSpeed);
        index += direction
    }

};
if ($(window).width() > 650) $("#header .desc span").typing({
    show: 3e3
});



$(document).on("click", ".post-share>a", function(e) {
    e.preventDefault();
    if ($(this).parent().hasClass("share-on")) {
        $(this).parent().removeClass("share-on");
        $(this).next().hide()
    } else {
        $(this).parent().addClass("share-on");
        $(this).next().show()
    }
    return false
});
$(document).on("click", ".post-share ul li a", function() {
    $(this).parent().parent().parent().removeClass("share-on");
    $(this).parent().parent().hide()
});
$(document).ready(function() {
    initgallary();
    refresh_qrimg();
    $("#qr").hover(function() {
        $("#qrimg").stop().fadeIn("normal")
    }, function() {
        $("#qrimg").stop().fadeOut("normal")
    })
});




//获取系统时间
Date.prototype.Format = function (fmt) { //author: meizz 
    var o = {
        "M+": this.getMonth() + 1, //月份 
        "d+": this.getDate(), //日 
        "H+": this.getHours(), //小时 
        "m+": this.getMinutes(), //分 
        "s+": this.getSeconds(), //秒 
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
        "S": this.getMilliseconds() //毫秒 
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
    return fmt;
}
// var time1 = new Date().Format("yyyy-MM-dd");
var sys_time = new Date().Format("yyyy-MM-dd HH:mm:ss");














function refresh_qrimg() {
    $('#qrimg').attr('src', 'http://qr.liantu.com/api.php?bg=ffffff&fg=47C2DC&gc=00aeef&el=l&w=150&m=1&text=' + location.href);
}

function initgallary() {
    $(".flexslider").flexslider({
        animation: "slide",
        controlNav: "thumbnails",
        smoothHeight: true,
        touch: true
    })
}
jQuery(window).scroll(function() {
    jQuery(this).scrollTop() > 100 ? jQuery("#gotop").css({
        bottom: "110px"
    }) : jQuery("#gotop").css({
        bottom: "-110px"
    })
});
jQuery("#gotop").click(function() {
    return jQuery("body,html").animate({
        scrollTop: 0
    }, 800), !1
});
var rollbox = $("#sidebar .widget"),
    rolllen = rollbox.length;
var asr_1 = parseInt(4),
    asr_2 = parseInt(6);
if (asr_1 !== -24 && asr_2 !== -38 && rolllen !== 0 && $("#sidebar").css("display") !== "none") {
    var sidebar_flying = false;
    $(window).scroll(function() {
        var roll = document.documentElement.scrollTop + document.body.scrollTop;
        if (roll > rollbox.eq(rolllen - 1).offset().top + rollbox.eq(rolllen - 1).height()) {
            if ($(".widgetRoller").length == 0) {
                rollbox.parent().append('<aside class="widgetRoller"></aside>');
                rollbox.eq(asr_1 - 1).clone().appendTo(".widgetRoller");
                if (asr_1 !== asr_2) rollbox.eq(asr_2 - 1).clone().appendTo(".widgetRoller");
                $(".widgetRoller").css({
                    position: "fixed",
                    top: 10,
                    display: "none"
                })
            }
            if (!sidebar_flying) $(".widgetRoller").fadeIn("normal");
            sidebar_flying = true
        } else {
            if (sidebar_flying) $(".widgetRoller").fadeOut("normal");
            sidebar_flying = false
        }
    })
}
$(document).on("click", ".commentnav a", function() {
    var baseUrl = $(this).attr("href"),
        commentsHolder = $(".commentshow"),
        id = $(this).parent().data("postid"),
        page = 1,
        concelLink = $("#cancel-comment-reply-link");
    if (/comment-page-/i.test(baseUrl)) page = baseUrl.split(/comment-page-/i)[1].split(/(\/|#|&).*jQuery/)[0];
    else {
        /cpage=/i.test(baseUrl) && (page = baseUrl.split(/cpage=/)[1].split(/(\/|#|&).*jQuery/)[0])
    }
    concelLink.click();
    page = page.split("#")[0];
    var ajax_data = {
        action: "ajax_comment_page_nav",
        um_post: id,
        um_page: page
    };
    commentsHolder.html("<div>loading..</div>");
    jQuery("body, html").animate({
        scrollTop: commentsHolder.offset().top - 150
    }, "normal");
    jQuery.post(ajax.ajax_url, ajax_data, function(data) {
        commentsHolder.html(data);
        $("body, html").animate({
            scrollTop: commentsHolder.offset().top - 50
        }, "normal");
        if (window.jdenticon) window.jdenticon()
    });
    return false
});
jQuery(document).on("click", ".open-nav", function() {
    var $body = $(document.body);
    if ($body.hasClass("has-opened")) {
        $body.removeClass("has-opened");
        $("#mobile-nav").hide("fast")
    } else {
        $("#mobile-nav").show("fast");
        $body.addClass("has-opened")
    }
});

function closeMobileSidebar() {
    $("body").removeClass("has-opened");
    $("#mobile-nav").hide("fast")
}
jQuery(document).on("touchstart", ".has-opened #wrap", closeMobileSidebar);
jQuery(document).on("click", "#mobile-nav li>a[href]", closeMobileSidebar);
// jQuery(document).ready(function($) {
//     $(".archives ul.archives-monthlisting").hide();
//     $(".archives ul.archives-monthlisting:first").show();
//     $(".archives .m-title").click(function() {
//         $(this).next().slideToggle("fast");
//         return false
//     });
//     add_views()
// });

// function add_views() {
//     var tmp = jQuery("#content>div>article");
//     if (tmp.length != 1) return;
//     tmp = tmp.attr("class");
//     var suzu = tmp.match(/post-([0-9]*)/);
//     if (suzu === null || suzu.length < 2) return;
//     var post_ID = suzu[1];
//     var data = {
//         action: "add_views",
//         post_ID: post_ID
//     };
//     jQuery.post(ajax.ajax_url, data)
// }
